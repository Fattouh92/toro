<% if @cheque != [] %>

  <h1>Table <%= Table.find(@tid).placement %> <%= Table.find(@tid).number %></h1>
  <br>
  <div class="tabbable tabs-left">
    <ul class="nav nav-tabs">
      <% @cheque.each do |ch| %>
        <li><a href="#<%= ch.id %>" data-toggle="tab">Cheque <%= ch.name %></a></li>
      <% end %>
    </ul>
    <div class="tab-content">
      <% @cheque.each do |ch| %>
        <div class="tab-pane" id="<%= ch.id %>">
          <table class="table table-condensed">
            <thead>
              <tr>
                <th><h2>Cashier <%= User.find(ch.cashier_id).firstname %> <%= User.find(ch.cashier_id).lastname %></h2></th>
                <th><h2>Captain <%= User.find(ch.captain_id).firstname %> <%= User.find(ch.captain_id).lastname %></h2></th>
                <th><h2><%= ch.number_of_customers %> customers</h2></th>
                <% if ch.sum < (ch.min_charge * ch.number_of_customers) %>
                  <th><span class="label label-important">minimum charge</span></th>
                <% else %>
                  <th><span class="label label-success">minimum charge</span></th>
                <% end %>
              </tr>
            </thead>
          </table>        
          <% @orders = Order.where(check_id: ch.id).all %>
          <% @orders.each do |order| %>
            <% @counter = @counter + 1 %>
            <h2>Order <%= @counter %> <h4><%= order.created_at %></h4></h2>
        
            <h2>Items</h2>
            <% @items = []
            @tempItems = Itemorder.where(order_id: order.id)
            @tempItems.each do |temp|
              item_id_temp = temp.item_id
              @items << Item.find(item_id_temp)
            end %>
            <table class="table table-condensed">
              <thead>
                <tr>
                  <th>name</th>
                  <th>arabic name</th>
                  <th>price</th>
                  <th>quantity</th>
                  <% if current_user.admin? %>
                    <th>delete 1 item</th>
                    <th>move 1 item</th>
                  <% end %>
                </tr>
              </thead>
              <tbody>
                <% @items.each do |item| %>
                  <div id="myModalDelete<%= item.id %>" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                      <h3 id="myModalLabel">Item decrement</h3>
                    </div>
                    <div class="modal-body">
                      <p>Are you sure you want to decrease item quantity by 1?</p>
                      <div class="prize-view"></div>
                    </div>
                    <div class="modal-footer">
                      <button class="btn" data-dismiss="modal" aria-hidden="true">No, go back</button>
                      <a class="btn btn-danger" href="/<%=ch.id%>/<%=order.id%>/<%=item.id%>/decrement_quantity">delete</a>
                    </div>
                  </div>
                  <tr>
                    <th><%= item.name %></th>
                    <th><%= item.arabicname %></th>
                    <% if item.offer.blank? %>
                      <th><%= item.price %></th>
                    <% else %>
                      <th><%= item.offer %></th>
                    <% end %>
                    <th><%=Itemorder.where(order_id: order.id, item_id: item.id).first.quantity%></th>
                    <% if current_user.admin? %>
                      <th><a class="btn btn-mini btn-danger" href="#myModalDelete<%= item.id %>" role="button" class="remove-one-item" data-toggle="modal"><i class="icon-trash"></i></a></th>
                      <th><a class="btn btn-mini btn-warning" href="/<%=ch.id%>/<%=order.id%>/<%=item.id%>/move_item"><i class="icon-cog"></i></a></th>
                    <% end %>
                  </tr>
                <% end %>
              </tbody>
            </table>
            <h5>Order <%= @counter %> total: <%= order.total %></h5><br>
          <% end %>
          <br>
          <% if ch.sum >= (ch.min_charge * ch.number_of_customers) %> 
            <h4>total of cheque before taxes: <%= ch.sum %></h4>
            <h4>total of cheque after taxes: <%= ch.sum + (ch.sum * (ch.taxrate + 0.00) * 0.01) %></h4>
          <% else %>
            <h4>total of cheque without minimu charge: <%= ch.sum %></h4>
            <h4>total of cheque before taxes: <%= ch.min_charge * (ch.number_of_customers + 0.00) %></h4>
            <h4>total of cheque after taxes: <%= ch.min_charge * (ch.number_of_customers + 0.00) + (ch.min_charge * (ch.number_of_customers + 0.00) * (ch.taxrate + 0.00) * 0.01) %></h4>
          <% end %>
          <div style="text-align:center;">
            <a class="btn btn-large btn-primary" href="/<%= @tid %>/<%= ch.id %>/new_order">Add Order</a>
            <a class="btn btn-large btn-primary" href="/<%= ch.id %>/close_cheque">Close Cheque</a>
          </div>
        </div>
      <% end %>
    </div>
  </div>


  <br><br><br>
  <div style="text-align:center;">
    <a class="btn btn-large btn-primary" href="/<%= @tid %>/new_cheque">Add cheque</a>
    <a class="btn btn-large" href="/tables">back</a>
  </div>
<% else %>
<br><br><br>
	<div style="text-align:center;">
		<a class="btn btn-large btn-primary" href="/<%= @tid %>/new_cheque">New Cheque</a>
    <a class="btn btn-large" href="/tables">back</a>
	</div>
<% end %>